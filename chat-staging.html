<html>
<head>
    <title>My chat</title>
</head>
<body>
    <script src="https://media.twiliocdn.com/sdk/js/flex-webchat/releases/2.1.2/twilio-flex-webchat.min.js"></script>
    <script>
        const appConfig = {
            accountSid:"ACd8a2e89748318adf6ddff7df6948deaf",
            flexFlowSid:"FO8c2d9c388e7feba8b08d06a4bc3f69d1",
            startEngagementOnInit: false,
            preEngagementConfig: {
                description: "Let's get started",
                fields:
                    [{
                        label: "What is your helpline?",
                        type: "SelectItem",
                        attributes: 
                        {
                            name: "helpline",
                            required: true,
                            readOnly: false
                        },
                        options: [
                        {
                            value: "Select helpline",
                            label: "Select helpline",
                            selected: true
                        }
                        ]
                    }],
                submitLabel: "Let's chat!"
            }
        };
        Twilio.FlexWebChat.createWebChat(appConfig).then(webchat => {
            const { manager } = webchat;
            Twilio.FlexWebChat.MessagingCanvas.defaultProps.predefinedMessage.body = "How can I help?";
        
            //Posting question from preengagement form as users first chat message
             Twilio.FlexWebChat.Actions.on("afterStartEngagement", (payload) => {
                 const { question } = payload.formData;
                 if (!question)
                    return;

                const { channelSid } = manager.store.getState().flex.session;
                manager
                    .chatClient.getChannelBySid(channelSid)
                    .then(channel => channel.sendMessage(question));
            });
            // Changing the Welcome message
            manager.strings.WelcomeMessage = "Welcome to Toronto Line!";
            manager.strings.MessageCanvasTrayContent = `
              <p>The counselor has left the chat.
              Thank you for reaching out.
              Please contact us again if you need more help.</p>
            `;
            // Render WebChat
            webchat.init();
        });
    </script>
</body>
</html>